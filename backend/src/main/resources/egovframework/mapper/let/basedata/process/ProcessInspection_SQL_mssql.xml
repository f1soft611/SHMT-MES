<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProcessInspectionDAO">

	<resultMap id="processInspectionResult" type="egovframework.let.basedata.process.domain.model.ProcessInspection">
		<result property="factoryCode" column="FACTORY_CODE"/>
		<result property="processId" column="PROCESS_ID"/>
		<result property="processCode" column="WORK_CODE"/>
		<result property="processInspectionId" column="INS_ID"/>
		<result property="inspectionCode" column="INS_CODE"/>
		<result property="inspectionName" column="INS_NAME"/>
		<result property="inspectionType" column="INSP_TYPE"/>
		<result property="standardValue" column="STANDARD_VALUE"/>
		<result property="upperLimit" column="UPPER_LIMIT"/>
		<result property="lowerLimit" column="LOWER_LIMIT"/>
		<result property="unit" column="UNIT"/>
		<result property="description" column="DESCRIPTION"/>
		<result property="useYn" column="USE_YN"/>
		<result property="regUserId" column="OPMAN_CODE"/>
		<result property="regDt" column="OPTIME"/>
		<result property="updUserId" column="OPMAN_CODE2"/>
		<result property="updDt" column="OPTIME2"/>
	</resultMap>

	<select id="ProcessInspectionDAO.selectProcessInspectionList" parameterType="egovframework.let.basedata.process.domain.model.ProcessInspectionVO" resultMap="processInspectionResult">
		SELECT
		FACTORY_CODE,
		WORK_ID AS PROCESS_ID,
		WORK_CODE,
		INS_ID,
		INS_CODE,
		INS_NAME,
		INS_TYPE AS INSP_TYPE,
		STANDARD_VALUE,
		UPPER_LIMIT,
		LOWER_LIMIT,
		UNIT,
		DESCRIPTION,
		USE_YN,
		OPMAN_CODE,
		CONVERT(VARCHAR(19), OPTIME, 120) AS OPTIME,
		OPMAN_CODE2,
		CONVERT(VARCHAR(19), OPTIME2, 120) AS OPTIME2
		FROM TPR107
		WHERE 1=1
		<if test="processId != null and processId != ''">
			AND WORK_ID = #{processId}
		</if>
		<if test="useYn != null and useYn != ''">
			AND USE_YN = #{useYn}
		</if>
		ORDER BY INS_CODE ASC
	</select>

	<insert id="ProcessInspectionDAO.insertProcessInspection" parameterType="egovframework.let.basedata.process.domain.model.ProcessInspection">
		INSERT INTO TPR107 (
		    FACTORY_CODE,
			WORK_ID,
			WORK_CODE,
			INS_ID,
			INS_CODE,
			INS_NAME,
			INS_TYPE,
			STANDARD_VALUE,
			UPPER_LIMIT,
			LOWER_LIMIT,
			UNIT,
			DESCRIPTION,
			USE_YN,
			OPMAN_CODE,
			OPTIME
		) VALUES (
		          	 #{factoryCode},
					 #{processId},
					 #{processCode},
					 #{processInspectionId},
					 #{inspectionCode},
					 #{inspectionName},
					 #{inspectionType},
					 #{standardValue},
					 #{upperLimit},
					 #{lowerLimit},
					 #{unit},
					 #{description},
					 ISNULL(#{useYn}, 'Y'),
					 #{regUserId},
					 GETDATE()
				 )
	</insert>

	<update id="ProcessInspectionDAO.updateProcessInspection" parameterType="egovframework.let.basedata.process.domain.model.ProcessInspection">
		UPDATE TPR107
		SET
			INS_CODE = #{inspectionCode},
			INS_NAME = #{inspectionName},
			INS_TYPE = #{inspectionType},
			STANDARD_VALUE = #{standardValue},
			UPPER_LIMIT = #{upperLimit},
			LOWER_LIMIT = #{lowerLimit},
			UNIT = #{unit},
			DESCRIPTION = #{description},
			USE_YN = #{useYn},
			OPMAN_CODE2 = #{updUserId},
			OPTIME2 = GETDATE()
		WHERE INS_ID = #{processInspectionId}
	</update>

	<delete id="ProcessInspectionDAO.deleteProcessInspection" parameterType="string">
		DELETE FROM TPR107
		WHERE INS_ID = #{processInspectionId}
	</delete>

</mapper>