<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CommonDetailCodeDAO">

	<resultMap id="commonDetailCodeResult" type="egovframework.let.basedata.commoncode.domain.model.CommonDetailCode">
		<result property="codeId" column="CODE_ID"/>
		<result property="code" column="CODE"/>
		<result property="codeNm" column="CODE_NM"/>
		<result property="codeDc" column="CODE_DC"/>
		<result property="useAt" column="USE_AT"/>
		<result property="frstRegistPnttm" column="FRST_REGIST_PNTTM"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID"/>
		<result property="lastUpdtPnttm" column="LAST_UPDT_PNTTM"/>
		<result property="lastUpdusrId" column="LAST_UPDUSR_ID"/>
	</resultMap>

	<select id="CommonDetailCodeDAO.selectCommonDetailCodeList" parameterType="String" resultMap="commonDetailCodeResult">
		SELECT
			CODE_ID,
			CODE,
			CODE_NM,
			CODE_DC,
			USE_AT,
			CONVERT(VARCHAR(19), FRST_REGIST_PNTTM, 120) AS FRST_REGIST_PNTTM,
			FRST_REGISTER_ID,
			CONVERT(VARCHAR(19), LAST_UPDT_PNTTM, 120) AS LAST_UPDT_PNTTM,
			LAST_UPDUSR_ID
		FROM MES_CCMMNDETAIL_CODE
		WHERE CODE_ID = #{codeId}
		ORDER BY CODE
	</select>

	<select id="CommonDetailCodeDAO.selectCommonDetailCodeListByUseAt" parameterType="java.util.Map" resultMap="commonDetailCodeResult">
		SELECT
			CODE_ID,
			CODE,
			CODE_NM,
			CODE_DC,
			USE_AT,
			CONVERT(VARCHAR(19), FRST_REGIST_PNTTM, 120) AS FRST_REGIST_PNTTM,
			FRST_REGISTER_ID,
			CONVERT(VARCHAR(19), LAST_UPDT_PNTTM, 120) AS LAST_UPDT_PNTTM,
			LAST_UPDUSR_ID
		FROM MES_CCMMNDETAIL_CODE
		WHERE CODE_ID = #{codeId}
		<if test="useAt != null and useAt != ''">
			AND USE_AT = #{useAt}
		</if>
		ORDER BY CODE
	</select>

	<select id="CommonDetailCodeDAO.selectCommonDetailCode" parameterType="java.util.Map" resultMap="commonDetailCodeResult">
		SELECT
			CODE_ID,
			CODE,
			CODE_NM,
			CODE_DC,
			USE_AT,
			CONVERT(VARCHAR(19), FRST_REGIST_PNTTM, 120) AS FRST_REGIST_PNTTM,
			FRST_REGISTER_ID,
			CONVERT(VARCHAR(19), LAST_UPDT_PNTTM, 120) AS LAST_UPDT_PNTTM,
			LAST_UPDUSR_ID
		FROM MES_CCMMNDETAIL_CODE
		WHERE CODE_ID = #{codeId}
		AND CODE = #{code}
	</select>

	<insert id="CommonDetailCodeDAO.insertCommonDetailCode" parameterType="egovframework.let.basedata.commoncode.domain.model.CommonDetailCode">
		INSERT INTO MES_CCMMNDETAIL_CODE (
			CODE_ID,
			CODE,
			CODE_NM,
			CODE_DC,
			USE_AT,
			FRST_REGISTER_ID
		) VALUES (
			#{codeId},
			#{code},
			#{codeNm},
			#{codeDc},
			#{useAt},
			#{frstRegisterId}
		)
	</insert>

	<update id="CommonDetailCodeDAO.updateCommonDetailCode" parameterType="egovframework.let.basedata.commoncode.domain.model.CommonDetailCode">
		UPDATE MES_CCMMNDETAIL_CODE
		SET
			CODE_NM = #{codeNm},
			CODE_DC = #{codeDc},
			USE_AT = #{useAt},
			LAST_UPDT_PNTTM = GETDATE(),
			LAST_UPDUSR_ID = #{lastUpdusrId}
		WHERE CODE_ID = #{codeId}
		AND CODE = #{code}
	</update>

	<delete id="CommonDetailCodeDAO.deleteCommonDetailCode" parameterType="java.util.Map">
-- 		DELETE FROM MES_CCMMNDETAIL_CODE
		UPDATE MES_CCMMNDETAIL_CODE
		SET
			USE_AT = 'N',
			LAST_UPDT_PNTTM = GETDATE(),
			LAST_UPDUSR_ID = 'SYSTEM'
		WHERE CODE_ID = #{codeId}
		AND CODE = #{code}
	</delete>

	<select id="CommonDetailCodeDAO.selectCodeCheck" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) AS CNT
		FROM MES_CCMMNDETAIL_CODE
		WHERE CODE_ID = #{codeId}
		AND CODE = #{code}
	</select>

</mapper>
