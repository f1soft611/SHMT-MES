<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProcessFlowProcessDAO">
    <resultMap id="processFlowProcessResult" type="egovframework.let.basedata.processFlow.domain.model.ProcessFlowProcess">
        <result property="factoryCode" column="FACTORY_CODE"/>
        <result property="processFlowId" column="WORK_ORDER_ID"/>
        <result property="processFlowCode" column="WORK_ORDER"/>
        <result property="flowProcessId" column="FLOW_PROCESS_ID"/>
        <result property="flowProcessCode" column="WORK_CODE"/>
        <result property="flowProcessName" column="WORK_CODE_NAME"/>
        <result property="seq" column="SEQ"/>
        <result property="processSeq" column="WORK_SEQ"/>
        <result property="lastFlag" column="LAST_FLAG"/>

        <result property="regUserId" column="OPMAN_CODE"/>
        <result property="regDt" column="OPTIME"/>
        <result property="updUserId" column="OPMAN_CODE2"/>
        <result property="updDt" column="OPTIME2"/>
    </resultMap>

    <select id="selectProcessFlowProcessList" parameterType="egovframework.let.basedata.processFlow.domain.model.ProcessFlowProcessVO" resultMap="processFlowProcessResult">
        SELECT
        FACTORY_CODE,
        WORK_ORDER_ID,
        WORK_ORDER,
        FLOW_PROCESS_ID,
        WORK_CODE,
        SEQ,
        WORK_SEQ,
        LAST_FLAG,
        OPTIME,
        OPMAN_CODE,
        OPTIME2,
        OPMAN_CODE2
        FROM TPR110D
        WHERE 1=1
        AND FACTORY_CODE = #{factoryCode}
        AND WORK_ORDER_ID = #{processFlowId}
        ORDER BY FLOW_PROCESS_ID
    </select>

    <select id="selectByProcessFlowId"
            parameterType="string"
            resultMap="processFlowProcessResult">
        SELECT
            A.FACTORY_CODE,
            A.WORK_ORDER_ID,
            A.WORK_ORDER,
            A.FLOW_PROCESS_ID,
            A.WORK_CODE,
            ISNULL(B.WORK_NAME, '') AS WORK_CODE_NAME,
            A.SEQ,
            A.WORK_SEQ,
            A.LAST_FLAG,
            A.OPTIME,
            A.OPMAN_CODE,
            A.OPTIME2,
            A.OPMAN_CODE2
        FROM TPR110D AS A
        LEFT JOIN TPR102 B
            ON A.FACTORY_CODE = B.FACTORY_CODE
            AND A.WORK_CODE = B.WORK_CODE
        WHERE WORK_ORDER_ID = #{value}
        ORDER BY SEQ
    </select>


    <!-- 공정흐름 공정 전체 삭제 -->
    <delete id="deleteAllByProcessFlowId" parameterType="string">
        DELETE FROM TPR110D
        WHERE WORK_ORDER_ID = #{value}
    </delete>

    <insert id="insertProcessFlowProcess" parameterType="egovframework.let.basedata.processFlow.domain.model.ProcessFlowProcess">
        INSERT INTO TPR110D (
            FACTORY_CODE,
            FLOW_PROCESS_ID,
            WORK_ORDER,
            WORK_ORDER_ID,
            WORK_CODE,
            SEQ,
            WORK_SEQ,
            LAST_FLAG,
            OPTIME,
            OPMAN_CODE
        ) VALUES (  #{factoryCode},
                     #{flowProcessId},
                     #{processFlowCode},
                     #{processFlowId},
                     #{flowProcessCode},
                     #{seq},
                     #{processSeq},
                     #{lastFlag},
                    GETDATE(),
                    'test'
                 )
    </insert>


</mapper>