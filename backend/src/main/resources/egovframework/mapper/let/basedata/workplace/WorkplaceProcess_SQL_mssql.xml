<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="WorkplaceProcessDAO">

	<resultMap id="workplaceProcessResult" type="egovframework.let.basedata.workplace.domain.model.WorkplaceProcess">
		<result property="factoryCode" column="FACTORY_CODE"/>
		<result property="workplaceId" column="WORKCENTER_ID"/>
		<result property="workplaceCode" column="WORKCENTER_CODE"/>
		<result property="processId" column="WORK_ID"/>
		<result property="processCode" column="WORK_CODE"/>
		<result property="processName" column="WORK_NAME"/>
		<result property="workplaceProcessId" column="WORK_ID"/>
		<result property="processSeq" column="WORK_SEQ"/>
		<result property="useYn" column="USE_YN"/>
		<result property="equipmentIntegrationYn" column="EQUIPMENT_INTEGRATION_YN"/>
		<result property="regUserId" column="OPMAN_CODE"/>
		<result property="regDt" column="OPTIME"/>
		<result property="updUserId" column="OPMAN_CODE2"/>
		<result property="updDt" column="OPTIME2"/>
	</resultMap>

	<select id="WorkplaceProcessDAO.selectWorkplaceProcessList" parameterType="egovframework.let.basedata.workplace.domain.model.WorkplaceProcessVO" resultMap="workplaceProcessResult">
		SELECT
		A.FACTORY_CODE,
		A.WORKCENTER_ID,
		A.WORKCENTER_CODE,
		A.WORK_CODE,
		A.WORK_NAME,
		A.WORK_ID,
		A.USE_YN,
		PR.EQUIPMENT_INTEGRATION_YN,
		A.OPMAN_CODE,
		CONVERT(VARCHAR(19), A.OPTIME, 120) AS OPTIME,
		A.OPMAN_CODE2,
		CONVERT(VARCHAR(19), A.OPTIME2, 120) AS OPTIME2
		FROM TPR103 A
			INNER JOIN TPR102 PR
			ON A.FACTORY_CODE = PR.FACTORY_CODE
			AND A.WORK_CODE = PR.WORK_CODE
		WHERE 1=1
		<if test="workplaceCode != null and workplaceCode != ''">
			AND A.WORKCENTER_CODE = #{workplaceCode}
		</if>
		<if test="processCode != null and processCode != ''">
			AND A.WORK_CODE = #{processCode}
		</if>
		<if test="useYn != null and useYn != ''">
			AND A.USE_YN = #{useYn}
		</if>
		ORDER BY A.OPTIME
	</select>

	<insert id="WorkplaceProcessDAO.insertWorkplaceProcess" parameterType="egovframework.let.basedata.workplace.domain.model.WorkplaceProcess">
		INSERT INTO TPR103 (
			FACTORY_CODE,
			WORKCENTER_ID,
			WORKCENTER_CODE,
			WORK_CODE,
			WORK_NAME,
			WORK_SEQ,
			WORK_ID,
			USE_YN,
			OPMAN_CODE,
			OPTIME
		) VALUES (
					 #{factoryCode},
					 #{workplaceId},
					 #{workplaceCode},
					 #{processCode},
					 #{processName},
					 ISNULL(
							 (SELECT MAX(WORK_SEQ) + 1
							  FROM TPR103
							  WHERE FACTORY_CODE = #{factoryCode}
								AND WORKCENTER_CODE = #{workplaceCode}),
							 1
						 ),
					 #{workplaceProcessId},
					 ISNULL(#{useYn}, 'Y'),
					 #{regUserId},
					 GETDATE()
				 )
	</insert>

	<delete id="WorkplaceProcessDAO.deleteWorkplaceProcess" parameterType="egovframework.let.basedata.workplace.domain.model.WorkplaceProcess">
		DELETE FROM TPR103
		WHERE WORKCENTER_CODE = #{workplaceCode}
		  AND WORK_CODE = #{processCode}
	</delete>

</mapper>