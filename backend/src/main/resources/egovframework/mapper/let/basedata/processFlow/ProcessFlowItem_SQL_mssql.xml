<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProcessFlowItemDAO">
    <resultMap id="processFlowItemResult" type="egovframework.let.basedata.processFlow.domain.model.ProcessFlowItem">
        <result property="factoryCode" column="FACTORY_CODE"/>
        <result property="processFlowId" column="WORK_ORDER_ID"/>
        <result property="processFlowCode" column="WORK_ORDER"/>
        <result property="flowItemId" column="FLOW_ITEM_ID"/>
        <result property="flowItemCode" column="PROD_CODE"/>
        <result property="flowItemCodeId" column="PROD_CODE_ID"/>
        <result property="flowItemName" column="PROD_CODE_NAME"/>
        <result property="specification" column="MATERIAL_SPEC"/>
        <result property="unit" column="UNIT"/>
        <result property="unitName" column="UNIT_NAME"/>

        <result property="regUserId" column="OPMAN_CODE"/>
        <result property="regDt" column="OPTIME"/>
        <result property="updUserId" column="OPMAN_CODE2"/>
        <result property="updDt" column="OPTIME2"/>
    </resultMap>

    <select
            id="selectItemByFlowId"
            parameterType="string"
            resultMap="processFlowItemResult">
        SELECT
            A.FACTORY_CODE,
            A.WORK_ORDER_ID,
            A.WORK_ORDER,
            A.FLOW_ITEM_ID,
            A.PROD_CODE,
            B.MATERIAL_NAME AS PROD_CODE_NAME,
            B.MATERIAL_SPEC,
            B.UNIT,
            ISNULL(B1.CODE_NM, '') AS UNIT_NAME,
            A.OPTIME,
            A.OPMAN_CODE,
            A.OPTIME2,
            A.OPMAN_CODE2
        FROM TPR112 A
        LEFT JOIN TCO403 B
            ON A.PROD_CODE = B.MATERIAL_CODE
            LEFT JOIN MES_CCMMNDETAIL_CODE B1
            ON B.UNIT = B1.CODE
        WHERE 1=1
        AND WORK_ORDER_ID = #{processFlowId}
        ORDER BY FLOW_ITEM_ID
    </select>

    <!-- 공정흐름 제품 전체 삭제 -->
    <delete id="deleteAllByProcessFlowId" parameterType="string">
        delete from  TPR112
        WHERE WORK_ORDER_ID = #{value}
    </delete>

    <!--    아이디별 삭제-->
    <delete id="deleteProcessFlowItemById" parameterType="string">
        DELETE FROM TPR112
        WHERE FLOW_ITEM_ID = #{value}
    </delete>

    <insert id="insertProcessFlowItem" parameterType="egovframework.let.basedata.processFlow.domain.model.ProcessFlowItem">
        INSERT INTO TPR112 (
            FACTORY_CODE,
            WORK_ORDER_ID,
            WORK_ORDER,
            FLOW_ITEM_ID,
            PROD_CODE,
            PROD_CODE_ID,
            OPTIME,
            OPMAN_CODE
        ) VALUES (
            #{factoryCode},
            #{processFlowId},
            #{processFlowCode},
            #{flowItemId},
            #{flowItemCode},
            #{flowItemCodeId},
            GETDATE(),
            'test'
        )
    </insert>




</mapper>