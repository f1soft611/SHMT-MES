# 권한별 읽기/쓰기 권한 구현 가이드

## 개요
이 문서는 MES 시스템에서 사용자 권한에 따라 화면의 등록, 수정, 삭제 버튼을 제어하는 방법을 설명합니다.

## 권한 시스템 구조

### 1. PermissionContext
`frontend/src/contexts/PermissionContext.tsx`에 정의된 권한 관리 컨텍스트입니다.

**주요 기능:**
- `hasReadPermission(menuUrl)`: 읽기 권한 확인
- `hasWritePermission(menuUrl)`: 쓰기 권한 확인
- `checkPermission(menuUrl)`: 권한 레벨 확인 ('read' | 'write' | 'none')

### 2. 권한 레벨
- **none**: 접근 불가
- **read**: 읽기 전용 (조회만 가능)
- **write**: 읽기/쓰기 (등록, 수정, 삭제 가능)

## 구현 방법

### Step 1: usePermissions 훅 import

```typescript
import { usePermissions } from '../../../contexts/PermissionContext';
```

### Step 2: 컴포넌트 내에서 권한 체크

```typescript
const YourComponent: React.FC = () => {
  // 권한 체크
  const { hasWritePermission } = usePermissions();
  const canWrite = hasWritePermission('/base-data/common-code');
  
  // ... 나머지 코드
}
```

**메뉴 URL 규칙:**
- 공통코드 관리: `/base-data/common-code`
- 공정 관리: `/base-data/process`
- 작업장 관리: `/base-data/workplace`
- 기타: 실제 라우트 경로 사용

### Step 3: 버튼에 disabled 속성 추가

#### 등록 버튼
```typescript
<Button
  variant="contained"
  color="primary"
  startIcon={<AddIcon />}
  onClick={handleOpenCreateDialog}
  disabled={!canWrite}  // 쓰기 권한이 없으면 비활성화
>
  등록
</Button>
```

#### 수정/삭제 버튼 (DataGrid 액션 컬럼)
```typescript
const columns: GridColDef[] = [
  // ... 다른 컬럼들
  {
    field: 'actions',
    headerName: '작업',
    renderCell: (params) => (
      <Stack direction="row" spacing={1}>
        <IconButton
          size="small"
          color="primary"
          onClick={() => handleEdit(params.row)}
          disabled={!canWrite}  // 쓰기 권한이 없으면 비활성화
        >
          <EditIcon />
        </IconButton>
        <IconButton
          size="small"
          color="error"
          onClick={() => handleDelete(params.row.id)}
          disabled={!canWrite}  // 쓰기 권한이 없으면 비활성화
        >
          <DeleteIcon />
        </IconButton>
      </Stack>
    ),
  },
];
```

## 실제 구현 예제: 공통코드 관리

### 전체 코드 예제

```typescript
import React, { useState } from 'react';
import { Button, IconButton } from '@mui/material';
import { Add as AddIcon, Edit as EditIcon, Delete as DeleteIcon } from '@mui/icons-material';
import { usePermissions } from '../../../contexts/PermissionContext';

const CommonCodeManagement: React.FC = () => {
  // 권한 체크
  const { hasWritePermission } = usePermissions();
  const canWrite = hasWritePermission('/base-data/common-code');

  const [openDialog, setOpenDialog] = useState(false);

  const handleOpenCreateDialog = () => {
    setOpenDialog(true);
  };

  const handleEdit = (code: any) => {
    // 수정 로직
  };

  const handleDelete = (codeId: string) => {
    // 삭제 로직
  };

  return (
    <Box>
      {/* 등록 버튼 */}
      <Button
        variant="contained"
        color="primary"
        startIcon={<AddIcon />}
        onClick={handleOpenCreateDialog}
        disabled={!canWrite}
      >
        공통코드 등록
      </Button>

      {/* DataGrid의 액션 컬럼 */}
      <DataGrid
        columns={[
          // ... 다른 컬럼들
          {
            field: 'actions',
            headerName: '작업',
            renderCell: (params) => (
              <Stack direction="row" spacing={1}>
                <IconButton
                  size="small"
                  color="primary"
                  onClick={() => handleEdit(params.row)}
                  disabled={!canWrite}
                >
                  <EditIcon />
                </IconButton>
                <IconButton
                  size="small"
                  color="error"
                  onClick={() => handleDelete(params.row.codeId)}
                  disabled={!canWrite}
                >
                  <DeleteIcon />
                </IconButton>
              </Stack>
            ),
          },
        ]}
      />
    </Box>
  );
};
```

## 주요 구현 화면

### 1. 공통코드 관리 (`CommonCodeManagement.tsx`)
- 공통코드 등록 버튼: `disabled={!canWrite}`
- 상세코드 등록 버튼: `disabled={!canWrite}`
- 수정/삭제 아이콘 버튼: `disabled={!canWrite}`

### 2. 공정 관리 (`ProcessManagement.tsx`)
- 공정 등록 버튼: `disabled={!canWrite}`
- 불량코드 추가 버튼: `disabled={!canWrite}`
- 검사항목 추가 버튼: `disabled={!canWrite}`
- 모든 수정/삭제 버튼: `disabled={!canWrite}`

### 3. 작업장 관리 (`WorkplaceManagement.tsx`)
- 작업장 등록 버튼: `disabled={!canWrite}`
- 수정/삭제 버튼: `disabled={!canWrite}`

## 권한 설정 방법

### 백엔드에서 권한 설정
1. 관리자 메뉴에서 "권한 관리" 접근
2. 사용자 그룹별로 메뉴 접근 권한 설정
3. 각 메뉴에 대해 권한 레벨 지정:
   - **read**: 조회만 가능
   - **write**: 조회, 등록, 수정, 삭제 가능

### 프론트엔드 동작
1. 로그인 시 사용자의 그룹ID 로드
2. PermissionContext가 해당 그룹의 메뉴 권한 로드
3. 각 화면에서 `hasWritePermission()`으로 권한 확인
4. 쓰기 권한이 없으면 버튼 비활성화

## 테스트 방법

### 1. 읽기 권한만 있는 사용자로 테스트
```
Expected:
- 모든 등록/수정/삭제 버튼이 비활성화됨 (disabled 상태)
- 조회/검색 기능은 정상 작동
- 상세 보기는 가능
```

### 2. 쓰기 권한이 있는 사용자로 테스트
```
Expected:
- 모든 버튼이 활성화됨
- 등록/수정/삭제 기능 정상 작동
```

## 주의사항

### 1. 메뉴 URL 일관성
- 메뉴 URL은 실제 라우트 경로와 일치해야 함
- kebab-case 사용 (예: `/base-data/common-code`)

### 2. 중첩된 권한
- 상세 화면(sub-dialog)도 동일한 권한 체크 적용
- 예: 공통코드 화면의 상세코드 등록도 공통코드 쓰기 권한 필요

### 3. 서버 측 검증
- 클라이언트 권한 체크는 UI 제어만 수행
- 서버에서도 반드시 권한 검증 필요 (보안)

## 추가 커스터마이징

### 버튼 숨기기 vs 비활성화

현재는 **비활성화(disabled)** 방식 사용:
```typescript
<Button disabled={!canWrite}>등록</Button>
```

만약 **완전히 숨기기**를 원한다면:
```typescript
{canWrite && (
  <Button>등록</Button>
)}
```

### 툴팁 추가
권한이 없을 때 이유 표시:
```typescript
<Tooltip title={canWrite ? "" : "쓰기 권한이 필요합니다"}>
  <span>
    <Button disabled={!canWrite}>등록</Button>
  </span>
</Tooltip>
```

## 문의
권한 관련 문제나 추가 요구사항이 있으면 개발팀에 문의하세요.
